select pitcherId, pitcherHand, pitcher, count(*) as tot_pitches,
	sum(case paResult when "HR" then 1 else 0 end) as tot_HR,
    sum(case battedBallType when "FB" then 1 else 0 end) as tot_FB,
    sum(case battedBallType when "LD" then 1 else 0 end) as tot_LD,
    sum(case when pitchResult = "IP" then 1 else 0 end) as tot_in_play,

	sum(case when paResult in ("FC", "K", "SF", "IP_OUT", "SH") then 1 else 0 end)/3 +
		sum(case paResult when "DP" then 2 else 0 end)/3 +
		sum(case paResult when "TP" then 3 else 0 end)/3 as IP,
	
    sum(case when (px < 0 and batterHand = "R") or (px > 0 and batterHand = "L") then 1 else 0 end)/count(*) as inside_perc,
    
    sum(case when pz > (szt + szb)/2 then 1 else 0 end)/count(*) as top_perc,

	avg(case when pitchType in ("FF", "FA") then releaseVelocity else null end) as ff_velo,
	count(case when pitchType in ("FF", "FA") then 1 else null end) as ff_count,
	count(case when pitchType in ("FF", "FA") then 1 else null end)/count(*) as ff_perc,
	avg(case when pitchType in ("FF", "FA") then abs(px-x0) else null end) as ff_xmov,
	avg(case when pitchType in ("FF", "FA") then abs(pz-z0) else null end) as ff_zmov,
	avg(case when pitchType in ("FF", "FA") then sqrt(power(px-x0,2) + power(pz-z0,2)) else null end) as ff_tot_mov,
	avg(case when pitchType in ("FF", "FA") then ax else null end) as ff_xacc,
	avg(case when pitchType in ("FF", "FA") then az else null end) as ff_zacc,
	avg(case when pitchType in ("FF", "FA") then spinRate else null end) as ff_spin,

	avg(case pitchType when "FT" then releaseVelocity else null end) as ft_velo,
	count(case pitchType when "FT" then releaseVelocity else null end) as ft_count,
	count(case pitchType when "FT" then releaseVelocity else null end)/count(*) as ft_perc,
	avg(case pitchType when "FT" then abs(px-x0) else null end) as ft_xmov,
	avg(case pitchType when "FT" then abs(pz-z0) else null end) as ft_zmov,
	avg(case pitchType when "FT" then sqrt(power(px-x0,2) + power(pz-z0,2)) else null end) as ft_tot_mov,
	avg(case pitchType when "FT" then ax else null end) as ft_xacc,
	avg(case pitchType when "FT" then az else null end) as ft_zacc,
	avg(case pitchType when "FT" then spinRate else null end) as ft_spin,

	avg(case pitchType when "CH" then releaseVelocity else null end) as ch_velo,
	count(case pitchType when "CH" then releaseVelocity else null end) as ch_count,
	count(case pitchType when "CH" then releaseVelocity else null end)/count(*) as ch_perc,
	avg(case pitchType when "CH" then abs(px-x0) else null end) as ch_xmov,
	avg(case pitchType when "CH" then abs(pz-z0) else null end) as ch_zmov,
	avg(case pitchType when "CH" then sqrt(power(px-x0,2) + power(pz-z0,2)) else null end) as ch_tot_mov,
	avg(case pitchType when "CH" then ax else null end) as ch_xacc,
	avg(case pitchType when "CH" then az else null end) as ch_zacc,
	avg(case pitchType when "CH" then spinRate else null end) as ch_spin,

	avg(case when pitchType in ("CU", "KC") then releaseVelocity else null end) as cu_velo,
	count(case when pitchType in ("CU", "KC") then releaseVelocity else null end) as cu_count,
	count(case when pitchType in ("CU", "KC") then releaseVelocity else null end)/count(*) as cu_perc,
	avg(case when pitchType in ("CU", "KC") then abs(px-x0) else null end) as cu_xmov,
	avg(case when pitchType in ("CU", "KC") then abs(pz-z0) else null end) as cu_zmov,
	avg(case when pitchType in ("CU", "KC") then sqrt(power(px-x0,2) + power(pz-z0,2)) else null end) as cu_tot_mov,
	avg(case when pitchType in ("CU", "KC") then ax else null end) as cu_xacc,
	avg(case when pitchType in ("CU", "KC") then az else null end) as cu_zacc,
	avg(case when pitchType in ("CU", "KC") then spinRate else null end) as cu_spin,

	avg(case pitchType when "SL" then releaseVelocity else null end) as sl_velo,
	count(case pitchType when "SL" then releaseVelocity else null end) as sl_count,
	count(case pitchType when "SL" then releaseVelocity else null end)/count(*) as sl_perc,
	avg(case pitchType when "SL" then abs(px-x0) else null end) as sl_xmov,
	avg(case pitchType when "SL" then abs(pz-z0) else null end) as sl_zmov,
	avg(case pitchType when "SL" then sqrt(power(px-x0,2) + power(pz-z0,2)) else null end) as sl_tot_mov,
	avg(case pitchType when "SL" then ax else null end) as sl_xacc,
	avg(case pitchType when "SL" then az else null end) as sl_zacc,
	avg(case pitchType when "SL" then spinRate else null end) as sl_spin,

	avg(case pitchType when "FC" then releaseVelocity else null end) as fc_velo,
	count(case pitchType when "FC" then releaseVelocity else null end) as fc_count,
	count(case pitchType when "FC" then releaseVelocity else null end)/count(*) as fc_perc,
	avg(case pitchType when "FC" then abs(px-x0) else null end) as fc_xmov,
	avg(case pitchType when "FC" then abs(pz-z0) else null end) as fc_zmov,
	avg(case pitchType when "FC" then sqrt(power(px-x0,2) + power(pz-z0,2)) else null end) as fc_tot_mov,
	avg(case pitchType when "FC" then ax else null end) as fc_xacc,
	avg(case pitchType when "FC" then az else null end) as fc_zacc,
	avg(case pitchType when "FC" then spinRate else null end) as fc_spin,

	avg(case pitchType when "FS" then releaseVelocity else null end) as fs_velo,
	count(case pitchType when "FS" then releaseVelocity else null end) as fs_count,
	count(case pitchType when "FS" then releaseVelocity else null end)/count(*) as fs_perc,
	avg(case pitchType when "FS" then abs(px-x0) else null end) as fs_xmov,
	avg(case pitchType when "FS" then abs(pz-z0) else null end) as fs_zmov,
	avg(case pitchType when "FS" then sqrt(power(px-x0,2) + power(pz-z0,2)) else null end) as fs_tot_mov,
	avg(case pitchType when "FS" then ax else null end) as fs_xacc,
	avg(case pitchType when "FS" then az else null end) as fs_zacc,
	avg(case pitchType when "FS" then spinRate else null end) as fs_spin,

	avg(case pitchType when "SI" then releaseVelocity else null end) as si_velo,
	count(case pitchType when "SI" then releaseVelocity else null end) as si_count,
	count(case pitchType when "SI" then releaseVelocity else null end)/count(*) as si_perc,
	avg(case pitchType when "SI" then abs(px-x0) else null end) as si_xmov,
	avg(case pitchType when "SI" then abs(pz-z0) else null end) as si_zmov,
	avg(case pitchType when "SI" then sqrt(power(px-x0,2) + power(pz-z0,2)) else null end) as si_tot_mov,
	avg(case pitchType when "SI" then ax else null end) as si_xacc,
	avg(case pitchType when "SI" then az else null end) as si_zacc,
	avg(case pitchType when "SI" then spinRate else null end) as si_spin

FROM trumedia_hackathon.pitches_2015
group by pitcherId, pitcherHand, pitcher;